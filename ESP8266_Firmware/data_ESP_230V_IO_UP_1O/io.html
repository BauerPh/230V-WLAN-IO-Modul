<!DOCTYPE html>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="style.css" type="text/css" />
<title>IO Einstellungen</title>

<form>
    <table border="0" cellspacing="0" cellpadding="3">
        <tr>
            <td align="left"><a href="admin.html" class="btn btn--s">&lt;</a>&nbsp;&nbsp;<strong>IO Einstellungen</strong></td>
        </tr>
        <tr><td align="left"><hr></td></tr>
        <tr>
            <td align="left">
                <div class="tab">
                    <button type ="button" class="tablinks" onclick="toggleTab(this, 'in1')" id="tabDefault">Eingang 1</button>
                    <button type ="button" class="tablinks" onclick="toggleTab(this, 'in2')">Eingang 2</button>
                    <button type ="button" class="tablinks" onclick="toggleTab(this, 'out1')">Ausgang</button>
                </div>
                <div id="tabcontentborder" class="tabcontentborder">
                    <div id="in1" class="tabcontent">
                        <table>
                            <tr>
                                <td align="left" colspan="3"><strong>MQTT Publish:</strong></td>
                            </tr>
                            <tr>
                                <td align="right">aktivieren:</td>
                                <td><input type="checkbox" id="in1enablePublish" name="in1enablePublish" onclick="javascript:enableDisableFields()"></td>
                                <td align="left"><span class="infotext"></span></td>
                            </tr>
                            <tr>
                                <td align="right">Topic:</td>
                                <td><input type="text" id="in1cmd.topic" name="in1cmd.topic" maxlength="128" value=""></td>
                                <td align="left"><span class="infotext"></span></td>
                            </tr>
                            <tr>
                                <td align="right">Payload bei ein:</td>
                                <td><input type="text" id="in1cmd.payloadOn" name="in1cmd.payloadOn" maxlength="128" value=""></td>
                                <td align="left"><span class="infotext"></span></td>
                            </tr>
                            <tr>
                                <td align="right">Payload bei aus:</td>
                                <td><input type="text" id="in1cmd.payloadOff" name="in1cmd.payloadOff" maxlength="128" value=""></td>
                                <td align="left"><span class="infotext"></span></td>
                            </tr>
                            <tr>
                                <td align="right">QoS:</td>
                                <td>
                                    <select id="in1cmd.qos" name="in1cmd.qos">
                                        <option value="0">0 (höchstens 1 mal)</option>
                                        <option value="1">1 (mindestens 1 mal)</option>
                                        <option value="2">2 (genau 1 mal)</option>
                                    </select>
                                </td>
                                <td align="left"><span class="infotext"></span></td>
                            </tr>
                            <tr>
                                <td align="right">retain:</td>
                                <td><input type="checkbox" id="in1cmd.retain" name="in1cmd.retain"></td>
                                <td align="left"><span class="infotext"></span></td>
                            </tr>
                            <tr>
                                <td align="left" colspan="3"><hr></td>
                            </tr>
                            <tr>
                                <td align="left" colspan="3"><strong>Ausgang steuern:</strong></td>
                            </tr>
                            <tr>
                                <td align="right">bei ein:</td>
                                <td>
                                    <select id="in1ctrlOutput1RisingEdge" name="in1ctrlOutput1RisingEdge">
                                        <option value="0">nicht steuern</option>
                                        <option value="1">Einschalten</option>
                                        <option value="2">Ausschalten</option>
                                        <option value="3">Wechseln</option>
                                    </select>
                                </td>
                                <td align="left"><span class="infotext"></span></td>
                            </tr>
                            <tr>
                                <td align="right">bei aus:</td>
                                <td>
                                    <select id="in1ctrlOutput1FallingEdge" name="in1ctrlOutput1FallingEdge">
                                        <option value="0">nicht steuern</option>
                                        <option value="1">Einschalten</option>
                                        <option value="2">Ausschalten</option>
                                        <option value="3">Wechseln</option>
                                    </select>
                                </td>
                                <td align="left"><span class="infotext"></span></td>
                            </tr>
                        </table>
                    </div>
                    <div id="in2" class="tabcontent">
                        <table>
                            <tr><td align="left" colspan="3"><strong>MQTT Publish:</strong></td></tr>
                            <tr>
                                <td align="right">aktivieren:</td>
                                <td><input type="checkbox" id="in2enablePublish" name="in2enablePublish" onclick="javascript:enableDisableFields()"></td>
                                <td align="left"><span class="infotext"></span></td>
                            </tr>
                            <tr>
                                <td align="right">Topic:</td>
                                <td><input type="text" id="in2cmd.topic" name="in2cmd.topic" maxlength="128" value=""></td>
                                <td align="left"><span class="infotext"></span></td>
                            </tr>
                            <tr>
                                <td align="right">Payload bei ein:</td>
                                <td><input type="text" id="in2cmd.payloadOn" name="in2cmd.payloadOn" maxlength="128" value=""></td>
                                <td align="left"><span class="infotext"></span> </td>
                            </tr>
                            <tr>
                                <td align="right">Payload bei aus:</td>
                                <td><input type="text" id="in2cmd.payloadOff" name="in2cmd.payloadOff" maxlength="128" value=""></td>
                                <td align="left"><span class="infotext"></span></td>
                            </tr>
                            <tr>
                                <td align="right">QoS:</td>
                                <td>
                                    <select id="in2cmd.qos" name="in2cmd.qos">
                                        <option value="0">0 (höchstens 1 mal)</option>
                                        <option value="1">1 (mindestens 1 mal)</option>
                                        <option value="2">2 (genau 1 mal)</option>
                                    </select>
                                </td>
                                <td align="left"><span class="infotext"></span></td>
                            </tr>
                            <tr>
                                <td align="right">retain:</td>
                                <td><input type="checkbox" id="in2cmd.retain" name="in2cmd.retain"></td>
                                <td align="left"><span class="infotext"></span></td>
                            </tr>
                            <tr>
                                <td align="left" colspan="3"><hr></td>
                            </tr>
                            <tr>
                                <td align="left" colspan="3"><strong>Ausgang steuern:</strong></td>
                            </tr>
                            <tr>
                                <td align="right">bei ein:</td>
                                <td>
                                    <select id="in2ctrlOutput1RisingEdge" name="in2ctrlOutput1RisingEdge">
                                        <option value="0">nicht steuern</option>
                                        <option value="1">Einschalten</option>
                                        <option value="2">Ausschalten</option>
                                        <option value="3">Wechseln</option>
                                    </select>
                                </td>
                                <td align="left"><span class="infotext"></span></td>
                            </tr>
                            <tr>
                                <td align="right">bei aus:</td>
                                <td>
                                    <select id="in2ctrlOutput1FallingEdge" name="in2ctrlOutput1FallingEdge">
                                        <option value="0">nicht steuern</option>
                                        <option value="1">Einschalten</option>
                                        <option value="2">Ausschalten</option>
                                        <option value="3">Wechseln</option>
                                    </select>
                                </td>
                                <td align="left"><span class="infotext"></span></td>
                            </tr>
                        </table>
                    </div>
                    <div id="out1" class="tabcontent">
                        <table>
                            <tr>
                                <td align="left" colspan="3"><strong>MQTT Subscribe:</strong></td>
                            </tr>
                            <tr>
                                <td align="right">aktivieren:</td>
                                <td>
                                    <input type="checkbox" id="out1enableSubscribe" name="out1enableSubscribe" onclick="javascript:enableDisableFields()">
                                </td>
                                <td align="left"><span class="infotext"></span></td>
                            </tr>
                            <tr>
                                <td align="right">Topic:</td>
                                <td>
                                    <input type="text" id="out1cmd.topic" name="out1cmd.topic" maxlength="128" value="">
                                </td>
                                <td align="left"><span class="infotext"></span></td>
                            </tr>
                            <tr>
                                <td align="right">ein bei Payload:</td>
                                <td>
                                    <input type="text" id="out1cmd.payloadOn" name="out1cmd.payloadOn" maxlength="128" value="">
                                </td>
                                <td align="left"><span class="infotext"></span></td>
                            </tr>
                            <tr>
                                <td align="right">aus bei Payload:</td>
                                <td>
                                    <input type="text" id="out1cmd.payloadOff" name="out1cmd.payloadOff" maxlength="128" value="">
                                </td>
                                <td align="left"><span class="infotext"></span></td>
                            </tr>
                            <tr>
                                <td align="right">QoS:</td>
                                <td>
                                    <select id="out1cmd.qos" name="out1cmd.qos">
                                        <option value="0">0 (höchstens 1 mal)</option>
                                        <option value="1">1 (mindestens 1 mal)</option>
                                        <option value="2">2 (genau 1 mal)</option>
                                    </select>
                                </td>
                                <td align="left"><span class="infotext"></span></td>
                            </tr>
                            <tr>
                                <td align="left" colspan="3"><hr></td>
                            </tr>
                            <tr>
                                <td align="left" colspan="3"><strong>MQTT Publish:</strong></td>
                            </tr>
                            <tr>
                                <td align="right">aktivieren:</td>
                                <td><input type="checkbox" id="out1enablePublish" name="out1enablePublish" onclick="javascript:enableDisableFields()"></td>
                                <td align="left"><span class="infotext"></span></td>
                            </tr>
                            <tr>
                                <td align="right">Topic:</td>
                                <td><input type="text" id="out1state.topic" name="out1state.topic" maxlength="128" value=""></td>
                                <td align="left"><span class="infotext"></span></td>
                            </tr>
                            <tr>
                                <td align="right">Payload bei ein:</td>
                                <td><input type="text" id="out1state.payloadOn" name="out1state.payloadOn" maxlength="128" value=""></td>
                                <td align="left"><span class="infotext"></span></td>
                            </tr>
                            <tr>
                                <td align="right">Payload bei aus:</td>
                                <td><input type="text" id="out1state.payloadOff" name="out1state.payloadOff" maxlength="128" value=""></td>
                                <td align="left"><span class="infotext"></span></td>
                            </tr>
                            <tr>
                                <td align="right">QoS:</td>
                                <td>
                                    <select id="out1state.qos" name="out1state.qos">
                                        <option value="0">0 (höchstens 1 mal)</option>
                                        <option value="1">1 (mindestens 1 mal)</option>
                                        <option value="2">2 (genau 1 mal)</option>
                                    </select>
                                </td>
                                <td align="left"><span class="infotext"></span></td>
                            </tr>
                            <tr>
                                <td align="right">retain:</td>
                                <td><input type="checkbox" id="out1state.retain" name="out1state.retain"></td>
                                <td align="left"><span class="infotext"></span></td>
                            </tr>
                            <tr>
                                <td align="left" colspan="3"><hr></td>
                            </tr>
                            <tr>
                                <td align="right">Startwert:</td>
                                <td>
                                    <select id="out1initState" name="out1initState">
                                        <option value="0">Aus</option>
                                        <option value="1">Ein</option>
                                    </select>
                                </td>
                                <td align="left"><span class="infotext"></span></td>
                            </tr>
                        </table>
                    </div>                    
                </div>
            </td>
        </tr>
        <tr>
            <td align="center"><button type="button" id="send" name="send" class="btn btn--m btn--blue" onclick="javascript:post()">Speichern</button></td>
        </tr>
        <tr>
            <td align="left"><span id="info" class="infotext"><br /></span></td>
        </tr>
    </table>
    </form>

<script>
    window.onload = function () {
        load("functions.js", function () {
            document.getElementById("tabDefault").click();
            setValues("/rest/io", function () { enableDisableFields(); });
            for (i = 0; i < document.forms[0].length; i++) {
                if ((document.forms[0].elements[i].type == 'text') || (document.forms[0].elements[i].type == 'password')) {
                    document.forms[0].elements[i].onfocus = resetBgThis;
                    document.forms[0].elements[i].onblur = checkValues;
                }
            }
        });
    }

    function checkValues() {
        var okay = true;
        for (var i = 1; i <= 2; i++) {
            if (!document.getElementById("in" + i + "enablePublish").checked) {
                resetBg("in" + i + "cmd.topic");
                resetBg("in" + i + "cmd.payloadOn");
                resetBg("in" + i + "cmd.payloadOff");
            } else {
                okay &= testStr("in" + i + "cmd.topic", "mqtt_topic", 1, 128);
                okay &= testStr("in" + i + "cmd.payloadOn", "string", 1, 128);
                okay &= testStr("in" + i + "cmd.payloadOff", "string", 1, 128);
            }
        }
        if (!document.getElementById("out1enableSubscribe").checked) {
            resetBg("out1cmd.topic");
            resetBg("out1cmd.payloadOn");
            resetBg("out1cmd.payloadOff");
        } else {
            okay &= testStr("out1cmd.topic", "mqtt_topic", 1, 128);
            okay &= testStr("out1cmd.payloadOn", "string", 1, 128);
            okay &= testStr("out1cmd.payloadOff", "string", 1, 128);
        }
        if (!document.getElementById("out1enablePublish").checked) {
            resetBg("out1state.topic");
            resetBg("out1state.payloadOn");
            resetBg("out1state.payloadOff");
        } else {
            okay &= testStr("out1state.topic", "mqtt_topic", 1, 128);
            okay &= testStr("out1state.payloadOn", "string", 1, 128);
            okay &= testStr("out1state.payloadOff", "string", 1, 128);
        }
        return okay;
    }

    function enableDisableFields() {
        for (var i = 1; i <= 2; i++) {
            document.getElementById("in" + i + "cmd.topic").disabled = !document.getElementById("in" + i + "enablePublish").checked;
            document.getElementById("in" + i + "cmd.payloadOn").disabled = !document.getElementById("in" + i + "enablePublish").checked;
            document.getElementById("in" + i + "cmd.payloadOff").disabled = !document.getElementById("in" + i + "enablePublish").checked;
            document.getElementById("in" + i + "cmd.qos").disabled = !document.getElementById("in" + i + "enablePublish").checked;
            document.getElementById("in" + i + "cmd.retain").disabled = !document.getElementById("in" + i + "enablePublish").checked;            
        }
        document.getElementById("out1cmd.topic").disabled = !document.getElementById("out1enableSubscribe").checked;
        document.getElementById("out1cmd.payloadOn").disabled = !document.getElementById("out1enableSubscribe").checked;
        document.getElementById("out1cmd.payloadOff").disabled = !document.getElementById("out1enableSubscribe").checked;
        document.getElementById("out1cmd.qos").disabled = !document.getElementById("out1enableSubscribe").checked;
        document.getElementById("out1state.topic").disabled = !document.getElementById("out1enablePublish").checked;
        document.getElementById("out1state.payloadOn").disabled = !document.getElementById("out1enablePublish").checked;
        document.getElementById("out1state.payloadOff").disabled = !document.getElementById("out1enablePublish").checked;
        document.getElementById("out1state.qos").disabled = !document.getElementById("out1enablePublish").checked;
        document.getElementById("out1state.retain").disabled = !document.getElementById("out1enablePublish").checked;
        checkValues();
    }

    function post() {
        if (checkValues()) {
            document.getElementById("send").disabled = true;
            document.getElementById("info").innerHTML = "Bitte warten...";
            var body = "";
            for (var i = 1; i <= 2; i++) {
                //input
                body += "in" + i + "enablePublish=" + document.getElementById("in" + i + "enablePublish").checked + "&";
                body += "in" + i + "cmd.topic=" + document.getElementById("in" + i + "cmd.topic").value + "&";
                body += "in" + i + "cmd.payloadOn=" + document.getElementById("in" + i + "cmd.payloadOn").value + "&";
                body += "in" + i + "cmd.payloadOff=" + document.getElementById("in" + i + "cmd.payloadOff").value + "&";
                body += "in" + i + "cmd.qos=" + document.getElementById("in" + i + "cmd.qos").value + "&";
                body += "in" + i + "cmd.retain=" + document.getElementById("in" + i + "cmd.retain").checked + "&";
                body += "in" + i + "ctrlOutput1RisingEdge=" + document.getElementById("in" + i + "ctrlOutput1RisingEdge").value + "&";
                body += "in" + i + "ctrlOutput1FallingEdge=" + document.getElementById("in" + i + "ctrlOutput1FallingEdge").value + "&";
            }
            body += "out1enableSubscribe=" + document.getElementById("out1enableSubscribe").checked + "&";
            body += "out1cmd.topic=" + document.getElementById("out1cmd.topic").value + "&";
            body += "out1cmd.payloadOn=" + document.getElementById("out1cmd.payloadOn").value + "&";
            body += "out1cmd.payloadOff=" + document.getElementById("out1cmd.payloadOff").value + "&";
            body += "out1cmd.qos=" + document.getElementById("out1cmd.qos").value + "&";
            body += "out1enablePublish=" + document.getElementById("out1enablePublish").checked + "&";
            body += "out1state.topic=" + document.getElementById("out1state.topic").value + "&";
            body += "out1state.payloadOn=" + document.getElementById("out1state.payloadOn").value + "&";
            body += "out1state.payloadOff=" + document.getElementById("out1state.payloadOff").value + "&";
            body += "out1state.qos=" + document.getElementById("out1state.qos").value + "&";
            body += "out1state.retain=" + document.getElementById("out1state.retain").checked + "&";
            body += "out1initState=" + document.getElementById("out1initState").value;
            microAjax("/post/io", afterpost, body);
        } else {
            document.getElementById("info").innerHTML = "Bitte die rot hinterlegten Felder prüfen...";
        }
    }

    function afterpost(res) {
        if (res == "OK") {
            document.getElementById("info").innerHTML = "gespeichert!";
        } else {
            document.getElementById("info").innerHTML = "Fehler! - es wurde nichts gespeichert!";
        }
        setValues("/rest/io", function () { enableDisableFields() });
        document.getElementById("send").disabled = false;
    }

    function toggleTab(but, id) {
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tabcontent");
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }
        tablinks = document.getElementsByClassName("tablinks");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        document.getElementById(id).style.display = "block";
        but.className += " active";
    }

    function load(e, n) {
        var a = document.createElement("script");
        a.src = e,
        a.type = "text/javascript",
        a.async = !1,
        a.onload = function () { n() },
        document.getElementsByTagName("head")[0].appendChild(a)
    }
</script>